<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>♠ ACRO HOLD'EM 06 ♠</title>
  <style>
    :root{font-family:Inter,system-ui,Segoe UI,Roboto,'Noto Sans KR',sans-serif}
    body{padding:8px;background:#f7f9fb;color:#111}
    .container{max-width:760px;margin:0 auto;background:#fff;padding:8px;border-radius:12px;box-shadow:0 6px 20px rgba(16,24,40,.08)}
    h1{font-size:20px;margin:0 0 12px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px 10px;text-align:left}
    thead th{font-weight:600;border-bottom:1px solid #e6eef6}
    tbody tr:nth-child(odd){background:#fbfdff}
    input[type=number]{width:90%;padding:6px 8px;border:1px solid #dbe7f5;border-radius:8px;font-size:14px}
    .mult{font-weight:700}
    .hint{font-size:13px;color:#6b7280;margin-top:10px}
    .row-flex{display:flex;gap:12px;align-items:center}
    .small{font-size:13px;color:#6b7280}
    footer{margin-top:16px;text-align:right}
    button{padding:8px 12px;border-radius:8px;border:0;background:#2563eb;color:white;cursor:pointer}
    button:active{transform:translateY(1px)}
    tfoot td{font-weight:bold;border-top:2px solid #ccc}
  </style>
</head>
<body>
  <div class="container">
    <table>
      <thead>
        <tr>
          <th style="width:60px"></th>
          <th style="width:75px">세전</th>
          <th style="width:40px"></th>
          <th>세후</th>
        </tr>
      </thead>
      <tbody id="tbody">
        <!-- rows are generated by JS -->
      </tbody>
      <tfoot>
        <tr>
          <td>검증</td>
          <td colspan="3" id="totalValue">—</td>
        </tr>
        <tr>
          <td>총세금</td>
          <td id="totalTAX">—</td>
          <td colspan="2"><button id="TAXCalBtn">세금 계산</button></td>
        </tr>
        <tr>
          <td colspan="2"><button id="resetBtn">초기화</button></td>
          <td></td>
          <td></td>
        </tr>
      </tfoot>
    </table>
  </div>

  <script>
    const names = ["서빠", "서맘", "도빠", "도맘", "혜빠", "혜맘", "지빠", "지맘"];
    const tbody = document.getElementById('tbody');
    const totalValueEl = document.getElementById('totalValue');
    const totalTAXEl = document.getElementById('totalTAX');

    function fmt(n){
      if(n === '' || n === null || isNaN(n)) return '';
      return Number(n).toLocaleString();
    }

    function updateTotal(){
      let sum = 0;
      document.querySelectorAll('input[type=number]').forEach(i => {
        const v = parseFloat(i.value);
        if(!isNaN(v)) sum += v;
      });
      totalValueEl.textContent = fmt(sum) || '—';
    }

    document.querySelectorAll('[data-mult]').forEach(s => s.textContent = '—');

    function updateTotalTAX(){

      let winners_pretax_sum = 0;
      let posttax_sum = 0;
      
      document.querySelectorAll('input[type=number]').forEach(i => {
        const v = parseFloat(i.value);
        if(!isNaN(v) && v > 0) winners_pretax_sum += v;
      });
      
      document.querySelectorAll('[data-mult]').forEach(s => {
        const v = parseFloat(s.textContent.replace(/,/g, ''));
        if(!isNaN(v)) posttax_sum += v;
      });

      totalTAXEl.textContent = fmt(winners_pretax_sum - posttax_sum) || '—';
    }

    function update_posttax(){
      names.forEach(name => {
        const target = document.querySelector(`[data-mult="${name}"]`);
        target.textContent = "${name}"
      });
    }

    function calculate_posttax(pretax_income) {
      const bars = [10000, 20000, 30000]
      const rates = [0.15, 0.25, 0.35, 0.45]
      return Math.min(bar[0], pretax_income)*rates[0] + Math.max(Math.min(bar[1], pretax_income) - bar[0], 0) * rate[1] + Math.max(Math.min(bar[2], pretax_income) - bar[1], 0) * rate[2] + Math.max(0, pretax_income - bar[2]) * rate[3];
    }

    names.forEach(name => {
      const tr = document.createElement('tr');

      const tdName = document.createElement('td');
      tdName.textContent = name;

      const tdToggleButton = document.createElement('td');
      const signBtn = document.createElement('button');
      signBtn.textContent = '±';
      signBtn.style.padding = '4px 8px';
      tdToggleButton.appendChild(signBtn);
      signBtn.addEventListener('click', () => {
        let v = parseFloat(input.value);
        const target = document.querySelector(`[data-mult="${name}"]`);
        if (!isNaN(v)) {
          input.value = -v;
          // 세후금액은 "-"처리하고, 검증용 총액값은 업데이트함
          target.textContent = "-"
          updateTotal();
          /*
          if(Number(-v) < 0){
            target.textContent = "-"
            updateTotal();
          } else {
            target.textContent = fmt(calculate_posttax(Number(input.value)));
            updateTotal();
          }
          */
        }
      });
      
      const tdInput = document.createElement('td');
      const input = document.createElement('input');
      input.type = 'number';
      input.step = 'any';
      input.min = -999999;
      input.placeholder = '입력';
      input.value = '';
      //input.setAttribute('inputmode', 'decimal'); // 키패드에서도 음수 허용
      input.setAttribute('pattern', '-?[0-9]*');  // 마이너스 허용

      input.dataset.person = name;
      tdInput.appendChild(input);
      
      const tdMult = document.createElement('td');
      tdMult.innerHTML = '<span class="mult" data-mult="'+name+'">—</span>';

      tr.appendChild(tdName);
      tr.appendChild(tdInput);
      tr.appendChild(tdToggleButton);
      tr.appendChild(tdMult);
      tbody.appendChild(tr);

      input.addEventListener('input', (e) => {
        /*
        const v = e.target.value;
        const target = document.querySelector(`[data-mult="${name}"]`);
        
        if(v === '' || v === '-' || isNaN(Number(v))) {
          target.textContent = '—';
        } else {
          if(Number(v) < 0){
            target.textContent = "-"
          } else {
            const num = calculate_posttax(Number(v));
            target.textContent = fmt(num); 
          }
        }
        */
        updateTotal();
      });
      
      /*
      input.addEventListener('input', (e) => {
        const v = e.target.value;
        const target = document.querySelector(`[data-mult="${name}"]`);
        
        if(v === '' || v === '-' || isNaN(Number(v))) {
          target.textContent = '—';
        } else {
          if(Number(v) < 0){
            target.textContent = "-"
          } else {
            const num = calculate_posttax(Number(v));
            target.textContent = fmt(num); 
          }
        }
        updateTotal();
      });
      */
      
    });

    document.getElementById('resetBtn').addEventListener('click', () => {
      document.querySelectorAll('input[type=number]').forEach(i => i.value = '');
      document.querySelectorAll('[data-mult]').forEach(s => s.textContent = '—');
      updateTotal();
      updateTotalTAX();
    });

    document.getElementById('TAXCalBtn').addEventListener('click', () => {
      updateTAX();
      update_posttax();
    });
  </script>
</body>
</html>



